<!DOCTYPE html>
<html lang="en" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Trading Companion</title>
    <link rel="stylesheet" href="/static/css/style.css?v=12">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;700&display=swap"
        rel="stylesheet">
</head>

<body>
    <!-- Header -->
    <header class="app-header">
        <div class="brand">
            <span class="logo-icon">‚óà</span>
            <h1>TradeCompanion <span class="v2-badge">V2</span></h1>
        </div>
        <nav class="app-nav">
            <button id="nav-dashboard-btn" class="nav-btn active">üìä Dashboard</button>
            <button id="nav-backtest-btn" class="nav-btn">üß™ Backtester</button>
        </nav>
        <div class="app-status">
            <div id="market-phase-badge" class="phase-badge">Loading...</div>
            <div class="vix-display">VIX: <span id="vix-val">--</span></div>
            <div id="ist-clock" class="clock">--:--:--</div>
            <div id="ws-status" class="status-indicator"></div>
        </div>
    </header>

    <!-- Market Pulse Bar -->
    <div class="ticker-bar">
        <div id="market-pulse" class="market-ticker">
            <span class="pulse-item">Loading market data...</span>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!--           PAGE 1: DASHBOARD                    -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="page-dashboard" class="page-content active">
        <div class="v2-layout">
            <!-- Left Column -->
            <div class="v2-left-col">

                <!-- AI Advisor -->
                <section class="panel ai-advisor-panel">
                    <div class="panel-header">
                        <h2>ü§ñ AI Advisor</h2>
                        <div class="ai-quota"><span id="ai-calls-badge">0/7 calls</span></div>
                    </div>
                    <div id="phase-guidance" class="advisor-guidance">
                        <span class="advisor-icon">üí°</span>
                        <p>Waiting for market data...</p>
                    </div>

                    <!-- Scan Controls -->
                    <div class="scan-controls">
                        <div class="strategy-row">
                            <label class="strategy-option"><input type="radio" name="strategy" value="s1" checked>
                                Momentum</label>
                            <label class="strategy-option"><input type="radio" name="strategy" value="s2"> VWAP
                                Bounce</label>
                            <label class="strategy-option"><input type="radio" name="strategy" value="s3"> Mean
                                Reversion</label>
                            <label class="strategy-option"><input type="radio" name="strategy" value="s4"> ORB</label>
                        </div>
                        <div class="scan-buttons">
                            <button id="scan-now-btn" class="btn primary scan-btn">‚ö° Scan Market Now</button>
                        </div>
                    </div>

                    <!-- AI Results -->
                    <div id="ai-result-section" class="ai-result-section" style="display:none;">
                        <div class="ai-result-header">
                            <span id="ai-result-type" class="ai-result-type"></span>
                            <span id="ai-result-time" class="ai-result-time"></span>
                        </div>
                        <div id="ai-result-body" class="ai-result-body"></div>
                    </div>
                </section>

                <!-- Open Positions -->
                <section class="panel positions-panel">
                    <div class="panel-header">
                        <h2>üìä Open Positions</h2>
                        <span id="total-pnl" class="pnl-badge">‚Çπ0.00</span>
                    </div>
                    <div id="positions-container">
                        <div class="empty-state">No open positions.</div>
                    </div>
                </section>

                <!-- Log Trade (Always Visible) -->
                <section class="panel trade-panel">
                    <div class="panel-header">
                        <h2>üìù Log Trade</h2>
                    </div>
                    <div class="trade-form">
                        <input type="text" id="qt-ticker" placeholder="RELIANCE.NS" class="qt-input">
                        <select id="qt-action" class="qt-input">
                            <option value="BUY">BUY</option>
                            <option value="SHORT SELL">SHORT SELL</option>
                        </select>
                        <input type="number" id="qt-entry" placeholder="Entry Price" class="qt-input" step="0.05">
                        <button id="qt-submit" class="btn primary">Validate & Log</button>
                    </div>
                    <div id="qt-feedback" class="qt-feedback"></div>
                    <p class="qt-note">SL, Target & Qty are auto-calculated by the Risk Engine using ATR math.</p>
                </section>
            </div>

            <!-- Right Column -->
            <div class="v2-right-col">
                <!-- Timeline -->
                <section class="panel timeline-panel">
                    <div class="panel-header">
                        <h2>üìÖ Today's Timeline</h2>
                    </div>
                    <div id="timeline-container" class="timeline-container">
                        <div class="empty-state">Events appear here as the day progresses.</div>
                    </div>
                </section>

                <!-- Trade History -->
                <section class="panel history-panel">
                    <div class="panel-header">
                        <h2>üìã Trade History</h2>
                    </div>
                    <table class="trades-table" id="trades-table">
                        <thead>
                            <tr>
                                <th>Ticker</th>
                                <th>Action</th>
                                <th>Entry</th>
                                <th>Exit/Status</th>
                                <th>Qty</th>
                                <th>P&L</th>
                            </tr>
                        </thead>
                        <tbody id="trades-body"></tbody>
                    </table>
                </section>

                <!-- Settings (Full) -->
                <details class="panel settings-panel">
                    <summary>
                        <h2>‚öôÔ∏è Settings</h2>
                    </summary>
                    <div class="settings-grid">
                        <div class="input-group">
                            <label>Capital (‚Çπ)</label>
                            <input type="number" id="capital-input" value="100000">
                        </div>
                        <div class="input-group">
                            <label>Max Risk/Trade (‚Çπ)</label>
                            <input type="number" id="risk-input" value="1000">
                        </div>
                        <div class="input-group">
                            <label>Search Engine</label>
                            <select id="search-engine-input" class="dropdown-style">
                                <option value="gemini">Gemini (Default)</option>
                                <option value="ddgs">DuckDuckGo</option>
                                <option value="tavily">Tavily (API)</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>Data Provider</label>
                            <select id="data-provider-input" class="dropdown-style">
                                <option value="yfinance">Yahoo Finance (Free)</option>
                                <option value="upstox">Upstox API (Broker)</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>AI Provider</label>
                            <select id="ai-provider-input" class="dropdown-style">
                                <option value="google">Google Gemini</option>
                                <option value="groq">Groq (Llama)</option>
                                <option value="sambanova">SambaNova</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>AI Model</label>
                            <select id="ai-model-input" class="dropdown-style">
                                <!-- Populated dynamically by JS based on provider -->
                            </select>
                        </div>
                        <div class="input-group"
                            style="grid-column: span 2; flex-direction:row; align-items:center; gap:8px;">
                            <input type="checkbox" id="auto-refresh-input" checked style="width:16px;height:16px;">
                            <label for="auto-refresh-input" style="margin:0;">Auto-refresh market data</label>
                        </div>
                        <div class="input-group" style="grid-column: span 2;">
                            <label>Broker API</label>
                            <a href="/upstox/connect" target="_blank" class="btn upstox-btn"
                                style="text-align:center;text-decoration:none;">üîó Connect Upstox</a>
                        </div>
                        <button id="save-settings-btn" class="btn primary" style="grid-column: span 2;">Save
                            Settings</button>
                    </div>
                </details>
            </div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!--           PAGE 2: BACKTESTER LAB                -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="page-backtest" class="page-content" style="display:none;">
        <div class="backtest-layout">
            <!-- Config Panel -->
            <section class="panel backtest-config">
                <h2>üß™ Backtester Lab</h2>
                <p class="panel-subtitle">Test a strategy on historical data before risking real money.</p>

                <div class="bt-form">
                    <div class="input-group">
                        <label>Stock Ticker</label>
                        <input type="text" id="bt-ticker" placeholder="RELIANCE.NS" value="RELIANCE.NS">
                    </div>
                    <div class="input-group">
                        <label>Lookback Days</label>
                        <input type="number" id="bt-days" value="30" min="5" max="365">
                    </div>
                    <div class="input-group">
                        <label>Capital (‚Çπ)</label>
                        <input type="number" id="bt-capital" value="100000">
                    </div>

                    <fieldset class="param-fieldset">
                        <legend>Strategy Parameters</legend>
                        <div class="param-grid">
                            <div class="input-group">
                                <label>EMA Fast</label>
                                <input type="number" id="bt-ema-fast" value="9" min="3" max="50">
                            </div>
                            <div class="input-group">
                                <label>EMA Slow</label>
                                <input type="number" id="bt-ema-slow" value="21" min="10" max="100">
                            </div>
                            <div class="input-group">
                                <label>RSI Length</label>
                                <input type="number" id="bt-rsi-len" value="14" min="5" max="50">
                            </div>
                            <div class="input-group">
                                <label>RSI Buy Threshold</label>
                                <input type="number" id="bt-rsi-buy" value="40" min="20" max="50">
                            </div>
                            <div class="input-group">
                                <label>RSI Short Threshold</label>
                                <input type="number" id="bt-rsi-short" value="60" min="50" max="80">
                            </div>
                            <div class="input-group">
                                <label>Stop Loss %</label>
                                <input type="number" id="bt-sl" value="1.0" step="0.1" min="0.3" max="5">
                            </div>
                            <div class="input-group">
                                <label>Take Profit %</label>
                                <input type="number" id="bt-tp" value="2.0" step="0.1" min="0.5" max="10">
                            </div>
                        </div>
                    </fieldset>

                    <button id="run-backtest-btn" class="btn primary" style="width:100%;margin-top:12px;">üöÄ Run
                        Backtest</button>
                    <button id="ai-optimize-btn" class="btn secondary" style="width:100%;margin-top:8px;">‚ú® AI Optimize
                        Parameters</button>
                </div>
            </section>

            <!-- Results Panel -->
            <section class="panel backtest-results">
                <h2>üìä Results</h2>
                <div id="bt-results-container">
                    <div class="empty-state">Configure parameters on the left and click "Run Backtest" to see results.
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Chart Modal -->
    <div id="chart-modal" class="chart-modal" style="display:none;">
        <div class="chart-modal-content">
            <div class="chart-modal-header">
                <h2 id="chart-title">üìà Chart</h2>
                <div class="chart-meta">
                    <span id="chart-models-used" class="chart-models"></span>
                    <button id="chart-close-btn" class="btn close-chart-btn" onclick="closeChart()">‚úï</button>
                </div>
            </div>
            <div id="chart-container" style="width:100%;height:500px;"></div>
            <div id="chart-legend" class="chart-legend"></div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="toast-container"></div>

    <script src="https://unpkg.com/lightweight-charts@4.1.1/dist/lightweight-charts.standalone.production.js"></script>
    <script src="/static/js/app.js?v=13"></script>
</body>

</html>